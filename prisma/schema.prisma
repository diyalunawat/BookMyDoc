generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model appointments {
  id               String   @id
  patient_id       String
  doctor_id        String
  appointment_date DateTime @db.Date
  appointment_time DateTime @db.Time(6)
  status           String   @default("pending")
  notes            String?
  created_at       DateTime @default(now())
  updated_at       DateTime
  doctors          doctors  @relation(fields: [doctor_id], references: [id], onDelete: Cascade)
  profiles         profiles @relation(fields: [patient_id], references: [id], onDelete: Cascade)

  @@unique([doctor_id, appointment_date, appointment_time])
  @@index([appointment_date])
  @@index([doctor_id])
  @@index([patient_id])
}

model doctor_availability {
  id           String   @id
  doctor_id    String
  day_of_week  Int
  start_time   DateTime @db.Time(6)
  end_time     DateTime @db.Time(6)
  is_available Boolean  @default(true)
  created_at   DateTime @default(now())
  doctors      doctors  @relation(fields: [doctor_id], references: [id], onDelete: Cascade)

  @@unique([doctor_id, day_of_week, start_time])
  @@index([doctor_id])
}

model doctor_reviews {
  id          String   @id
  doctor_id   String
  patient_id  String
  rating      Int
  review_text String?
  created_at  DateTime @default(now())
  doctors     doctors  @relation(fields: [doctor_id], references: [id], onDelete: Cascade)
  profiles    profiles @relation(fields: [patient_id], references: [id], onDelete: Cascade)

  @@unique([doctor_id, patient_id])
}

model doctors {
  id                  String                @id
  specialization      String
  qualification       String
  experience_years    Int
  consultation_fee    Decimal               @db.Decimal(10, 2)
  clinic_location     String
  city                String
  bio                 String?
  rating              Decimal               @default(0) @db.Decimal(3, 2)
  total_ratings       Int                   @default(0)
  created_at          DateTime              @default(now())
  updated_at          DateTime
  appointments        appointments[]
  doctor_availability doctor_availability[]
  doctor_reviews      doctor_reviews[]
  profiles            profiles              @relation(fields: [id], references: [id], onDelete: Cascade)

  @@index([city])
  @@index([rating])
  @@index([specialization])
}

model profiles {
  id                String           @id
  role              String
  full_name         String
  phone             String?
  age               Int?
  gender            String?
  profile_photo_url String?
  created_at        DateTime         @default(now())
  updated_at        DateTime
  email             String           @unique
  password          String
  appointments      appointments[]
  doctor_reviews    doctor_reviews[]
  doctors           doctors?
}
